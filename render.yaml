# Render.com Blueprint - Auto-deploys all services
# Deploy: Push to GitHub, then on Render.com: New → Blueprint → Connect Repo

services:
  # Main Application - Monolith (Go + React)
  - type: web
    name: monolith
    env: docker
    dockerfilePath: ./Dockerfile.monolith
    dockerContext: .
    envVars:
      - key: PORT
        value: 8080
      - key: JWT_SECRET
        generateValue: true
      - key: DGRAPH_ADDRESS
        fromService:
          type: pserv
          name: dgraph
          property: hostport
      # REDIS_URL will be added manually after deployment
      # Create Key Value store "whitepaper-redis" then link it
      - key: REDIS_URL
        value: redis://whitepaper-redis:6379
      - key: NATS_URL
        value: nats://nats:4222
      - key: QDRANT_URL
        fromService:
          type: pserv
          name: qdrant
          property: hostport
    healthCheckPath: /health
    autoDeploy: true

  # DGraph Database
  - type: pserv
    name: dgraph
    env: docker
    dockerfilePath: ./services/dgraph/Dockerfile
    dockerContext: .
    disk:
      name: dgraph-data
      mountPath: /dgraph
      sizeGB: 10

  # NATS Message Queue
  - type: pserv
    name: nats
    env: docker
    dockerfilePath: ./services/nats/Dockerfile
    dockerContext: .

  # Qdrant Vector Database
  - type: pserv
    name: qdrant
    env: docker
    dockerfilePath: ./services/qdrant/Dockerfile
    dockerContext: .
    disk:
      name: qdrant-data
      mountPath: /qdrant/storage
      sizeGB: 10
